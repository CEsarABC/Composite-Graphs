<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dc/2.1.8/dc.min.css" type="text/css" />
    <script type="text/javascript" src="d3.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.12/crossfilter.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dc/2.1.8/dc.min.js"></script>
    <script type="text/javascript" src="jsModules/queue.min.js"></script>
    <script src="arrays.js"></script>
    <title>Crossfilter</title>
    <style>
        .container{
            width: auto;
            height: auto;
            border: solid 1px red;
            margin: 10px;
            float: left;
        }
    </style>
</head>
<body>
<h1>Data Visualisation</h1>

    <h2>scatter-plot</h2>

    <div>
        <div id="scatter-plot"></div>
    </div>

    <script>

    function makeGraphs() {

        var ndx = crossfilter(woman);

        var parseDate = d3.time.format("%d/%m/%Y").parse;
        woman.forEach(function(d){
            d.date_p = parseDate(d.date_p);
        });

        var date_dim = ndx.dimension(dc.pluck('date_p'));

        var min_date = date_dim.bottom(1)[0].date_p;
        var max_date = date_dim.top(1)[0].date_p;

        var salary_dim = ndx.dimension(function (d) {
            return [d.date_p, d.salary_p, d.name_p];
        });

        var tradeColors = d3.scale.ordinal()
            .domain(['Alejandra','Martina','Josefa','Renata','Francis','Mariana','Flora','Tatiana','Marisol','Kim',
    'Alexa','Isabel','Cecilia','Aquila','Augusta','Aurelia','Flavia','Horatia'])
            .range(["red", "green", "blue",'orange','black','yellow','brown','purple',
                '#2D2C34','#68941B','#CB4F2D','#9C4A1A','#1F779F','#4C4D4F','#0D3649','#64400B','#863B21','#5B5348']);


        var salary_group = salary_dim.group();

        var subChart = function (c) {
            return dc.scatterPlot(c)
                .symbolSize(8)
                .highlightedSize(10);
        };


        var chart = dc.seriesChart("#scatter-plot");
        chart
            .width(900)
            .height(450)
            .chart(subChart)
            .x(d3.time.scale().domain([min_date, max_date]))
            .brushOn(false)
            .clipPadding(10)
            .yAxisLabel("Salary")
            .xAxisLabel("Birth")
            .elasticY(true)
            .dimension(salary_dim)
            .group(salary_group)
            .mouseZoomable(true)
            .shareTitle(false) // allow default scatter title to work
            .seriesAccessor(function (d) {
                return d.key[2];
            })
            .keyAccessor(function (d) {
                return d.key[0];
            })
            .valueAccessor(function (d) {
                return +d.key[1];
            })
            .colorAccessor(function (d) {
                return d.key[2].name_p;
            })
            .colors(tradeColors)

            .legend(dc.legend().x(770).y(50).itemHeight(13).gap(5).horizontal(1).legendWidth(70).itemWidth(70));

        chart.margins().left += 20;
        chart.margins().bottom += 20;
        chart.margins().right = 150;
        dc.renderAll();
    }
    makeGraphs();

    </script>
</div>
<h1>Data Vizualisation</h1>

    <h2>DC Average</h2>

    <div>
    <h3>Select Store</h3>
    <div id="store-selector"></div>
    </div>

    <div>
    <h3>Person Spend</h3>
    <div id="person-spend-chart"></div>

    </div>
<div>
    <script>
    function makeGraphs() {
        var ndx = crossfilter(woman);

        var cityDim = ndx.dimension(dc.pluck('town_p'));

        var selectCity = dc.selectMenu('#store-selector');
        cityDim = ndx.dimension(dc.pluck('town_p'));
        selectCityGroup = cityDim.group();

        selectCity
            .dimension(cityDim)
            .group(selectCityGroup);


        var personDim = ndx.dimension(dc.pluck('name_p'));
        var salaryByPerson = personDim.group().reduceSum(dc.pluck('salary_p'));
        dc.rowChart("#person-spend-chart")
            .width(900)
            .height(700)
            .dimension(personDim)
            .group(salaryByPerson)
            .xAxis().ticks(10);

        dc.renderAll();
    };
    makeGraphs();
    </script>

</div>



</body>
</html>